name: 24/7 YouTube Live Stream

on:
  schedule:
    # Multiple schedules for continuous 24/7 coverage
    - cron: '0 0 * * *'    # Every day at 00:00 UTC
    - cron: '0 6 * * *'    # Every day at 06:00 UTC
    - cron: '0 12 * * *'   # Every day at 12:00 UTC
    - cron: '0 18 * * *'   # Every day at 18:00 UTC
  
  workflow_dispatch:  # Manual trigger
  
  push:
    branches: [ main, master ]

jobs:
  stream:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 hours (maximum for free tier)
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v3
      
      - name: ğŸ Setup Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: ğŸ“¦ Install FFmpeg
        run: |
          echo "ğŸ“¦ Installing FFmpeg..."
          sudo apt-get update -qq
          sudo apt-get install -y ffmpeg
          echo "âœ… FFmpeg installed!"
          ffmpeg -version | head -n 1
      
      - name: ğŸ“š Install Python Dependencies
        run: |
          echo "ğŸ“š Installing Python packages..."
          pip install --upgrade pip
          pip install requests
          echo "âœ… Dependencies installed!"
      
      - name: ğŸ’¾ Check Disk Space
        run: |
          echo "ğŸ’¾ Available disk space:"
          df -h / | tail -1
      
      - name: ğŸ¬ Start 24/7 YouTube Live Stream
        env:
          YOUTUBE_STREAM_KEY: ${{ secrets.YOUTUBE_STREAM_KEY }}
          VIDEO_URL: ${{ secrets.VIDEO_URL }}
          VIDEO_QUALITY: ${{ secrets.VIDEO_QUALITY }}
          ASPECT_RATIO: ${{ secrets.ASPECT_RATIO }}
        run: |
          echo "=================================="
          echo "ğŸ”´ Starting 24/7 LIVE Stream"
          echo "=================================="
          echo "â° Started at: $(date)"
          echo "ğŸŒ Server: GitHub Actions"
          echo "ğŸ’» Your PC: Can be OFF!"
          echo "ğŸ“¡ Stream: Will run for 6 hours"
          echo "ğŸ”„ Auto-restart: Every 6 hours"
          echo "=================================="
          python streamer.py
      
      - name: ğŸ§¹ Cleanup
        if: always()
        run: |
          echo "ğŸ§¹ Cleaning up..."
          rm -f video.mp4
          echo "âœ… Cleanup done"
      
      - name: ğŸ“Š Stream Summary
        if: always()
        run: |
          echo "=================================="
          echo "ğŸ“Š Stream Session Complete"
          echo "=================================="
          echo "â° Ended at: $(date)"
          echo "ğŸ”„ Next session: Auto-starting soon"
          echo "âœ… Status: Completed"
          echo "=================================="
